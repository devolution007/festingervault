import{c as f,f as D,N as y,u as C,j as e,B as o,J as m}from"./CeOzJR91.7520e6.js";import{h as N,u as R,D as I,a as M,L as b,b as B,c as L,d as q,e as E,f as U,g as x}from"./OwELbk-u.7520e6.js";import{a as A,u as P}from"./D4lagk1J.7520e6.js";/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=f("CloudDownload",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m8 17 4 4 4-4",key:"1ul180"}]]);/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=f("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=f("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function K(i,n){const d=React.useMemo(()=>["wordpress-themes","wordpress-plugins"].includes(i.type),[i]),{list:a}=D(),l=React.useMemo(()=>a==null?void 0:a.find(c=>c.id===i.id),[a]),s=React.useMemo(()=>l?y(l.version,l.installed_version,"gt")===!0:!1,[l,a]),r=React.useMemo(()=>l&&n?y(l.installed_version,n.version,"gt")===!0:!1,[l,n]);return{isInstalled:l,isNewerVersion:s,isInstallable:d,isRollBack:r}}function V({item:i,media:n,size:d,variant:a}){const l=A(),{data:s}=N(),r=C(),{isPending:c,mutateAsync:_}=R("item/install"),{isInstalled:t,isNewerVersion:u,isInstallable:w,isRollBack:p}=K(i,n),{tab:k}=P("/item/:type/detail/:id/:tab?");function j(v){if(typeof(s==null?void 0:s.plan_type)>"u"){m.error(wp.i18n.__("License not activated")),l("/activation");return}m.promise(_({item_id:i.id,method:v===!0?"download":"install",media_id:n==null?void 0:n.id}),{description:wp.htmlEntities.decodeEntities(i.title),loading:v===!0?"Downloading":p?wp.i18n.sprintf("Roll-Back to version %s",n.version):t?u?"Updating":"Re-Installing":"Installing",success(h){return h.link&&v===!0&&window.open(h.link,"_blank"),r.invalidateQueries({queryKey:["update/list"]}),r.invalidateQueries({queryKey:["item/detail"]}),r.invalidateQueries({queryKey:["history/list"]}),wp.i18n.__("Successful")},error(h){return h.message}})}return e.jsxs(I,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(o,{variant:a,size:d,className:"flex items-center gap-2",disabled:c,children:[c?e.jsx(b,{className:"h-4 w-4 animate-spin"}):e.jsx(g,{width:16}),d!="icon"&&e.jsx("span",{children:w?p?"Roll-Back":t?u?"Update":"Re-Install":"Install":"Download"})]})}),e.jsx(B,{children:e.jsxs("div",{className:"mx-auto w-full max-w-sm",children:[e.jsxs(L,{className:"text-center",children:[e.jsx(q,{className:"text-center leading-normal",children:wp.htmlEntities.decodeEntities(i.title)}),e.jsx(E,{className:"flex flex-col gap-2 text-center",asChild:!0,children:e.jsxs("div",{children:[e.jsx("div",{children:w?p?wp.i18n.sprintf("Roll-back to version from %s to %s",t.installed_version,n.version):t?u?wp.i18n.sprintf("Update version from %s to %s",t.installed_version,t.version):wp.i18n.sprintf(wp.i18n.__("Re-install version %s"),n?n.version:t.version):wp.i18n.sprintf("Install version %s",n?n.version:i.version):wp.i18n.sprintf("Download version %s",n?n.version:i.version)}),e.jsx("div",{children:wp.i18n.sprintf(wp.i18n.__("%d download credit would be consumed from your account."),1)}),e.jsxs("div",{className:"flex flex-row justify-center divide-x",children:[e.jsxs("div",{className:"px-4",children:["Daily Limit: ",s==null?void 0:s.today_limit]}),e.jsxs("div",{className:"px-4",children:["Used Limit: ",s==null?void 0:s.today_limit_used]}),(s==null?void 0:s.plan_title)==="recurring"&&e.jsxs("div",{className:"p-4",children:["Total Limit: ",s==null?void 0:s.total_limit]})]})]})})]}),e.jsx(U,{children:e.jsxs("div",{className:"flex flex-row justify-center gap-4",children:[w&&e.jsx(x,{asChild:!0,children:e.jsxs(o,{onClick:()=>j(!1),variant:"default",className:"gap-2",children:[e.jsx(g,{size:16}),e.jsx("span",{children:p?"Roll-Back":t?u?"Update":"Re-Install":"Install"})]})}),e.jsx(x,{asChild:!0,children:e.jsxs(o,{onClick:()=>j(!0),variant:"outline",className:"gap-2",children:[e.jsx(Q,{size:16}),e.jsx("span",{children:wp.i18n.__("Download")})]})}),k!=="changelog"&&e.jsx(x,{asChild:!0,children:e.jsxs(o,{onClick:()=>l("/item/:type/detail/:id/:tab?",{params:{type:i.type,id:i.id,tab:"changelog"}}),variant:"outline",className:"gap-2",children:[e.jsx(H,{size:16}),e.jsx("span",{children:wp.i18n.__("Roll-Back")})]})}),e.jsx(x,{asChild:!0,children:e.jsx(o,{variant:"outline",children:wp.i18n.__("Cancel")})})]})})]})})]})}export{V as I,K as u};
