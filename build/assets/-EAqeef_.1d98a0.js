import{c as _,e as y,N as j,u as D,j as e,B as x,J as m}from"./CE8nbfiq.1d98a0.js";import{h as I,u as N,D as k,a as R,L as C,b as B,c as b,d as L,e as M,f as E,g as f}from"./DJVmx3xu.1d98a0.js";import{a as U}from"./Bg_-1mmp.1d98a0.js";/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=_("CloudDownload",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m8 17 4 4 4-4",key:"1ul180"}]]);function q(l,n){const a=React.useMemo(()=>["wordpress-themes","wordpress-plugins"].includes(l.type),[l]),{list:t}=y(),i=React.useMemo(()=>t==null?void 0:t.find(d=>d.id===l.id),[t]),s=React.useMemo(()=>i?j(i.version,i.installed_version,"gt")===!0:!1,[i,t]),o=React.useMemo(()=>i&&n?j(i.installed_version,n.version,"gt")===!0:!1,[i,n]);return{isInstalled:i,isNewerVersion:s,isInstallable:a,isRollBack:o}}function J({item:l,media:n,size:a,variant:t}){const i=U(),{data:s}=I(),o=D(),{isPending:d,mutateAsync:g}=N("item/install"),{isInstalled:r,isNewerVersion:c,isInstallable:h,isRollBack:u}=q(l,n);function v(w){if(typeof(s==null?void 0:s.plan_type)>"u"){m.error(wp.i18n.__("License not activated")),i("/activation");return}m.promise(g({item_id:l.id,method:w===!0?"download":"install",media_id:n==null?void 0:n.id}),{description:wp.htmlEntities.decodeEntities(l.title),loading:w===!0?"Downloading":u?wp.i18n.sprintf("Roll-Back to version %s",n.version):r?c?"Updating":"Re-Installing":"Installing",success(p){return p.link&&w===!0&&window.open(p.link,"_blank"),o.invalidateQueries({queryKey:["update/list"]}),o.invalidateQueries({queryKey:["item/detail"]}),wp.i18n.__("Successful")},error(p){return p.message}})}return e.jsxs(k,{children:[e.jsx(R,{asChild:!0,children:e.jsxs(x,{variant:t,size:a,className:"flex items-center gap-2",disabled:d,children:[d?e.jsx(C,{className:"h-4 w-4 animate-spin"}):e.jsx(A,{width:16}),a!="icon"&&e.jsx("span",{children:h?u?"Roll-Back":r?c?"Update":"Re-Install":"Install":"Download"})]})}),e.jsx(B,{children:e.jsxs("div",{className:"mx-auto w-full max-w-sm",children:[e.jsxs(b,{className:"text-center",children:[e.jsx(L,{className:"text-center leading-normal",children:wp.htmlEntities.decodeEntities(l.title)}),e.jsx(M,{className:"flex flex-col gap-2 text-center",asChild:!0,children:e.jsxs("div",{children:[e.jsx("div",{children:h?u?wp.i18n.sprintf("Roll-back to version from %s to %s",r.installed_version,n.version):r?c?wp.i18n.sprintf("Update version from %s to %s",r.installed_version,r.version):wp.i18n.sprintf(wp.i18n.__("Re-install version %s"),n?n.version:r.version):wp.i18n.sprintf("Install version %s",n?n.version:l.version):wp.i18n.sprintf("Download version %s",n?n.version:l.version)}),e.jsx("div",{children:wp.i18n.sprintf(wp.i18n.__("%d download credit would be consumed from your account."),1)}),e.jsxs("div",{className:"flex flex-row justify-center gap-2 divide-x",children:[e.jsxs("div",{className:"px-4",children:["Daily Limit: ",s==null?void 0:s.today_limit]}),e.jsxs("div",{className:"px-4",children:["Used Limit: ",s==null?void 0:s.today_limit_used]}),(s==null?void 0:s.plan_title)==="recurring"&&e.jsxs("div",{className:"p-4",children:["Total Limit: ",s==null?void 0:s.total_limit]})]})]})})]}),e.jsx(E,{children:e.jsxs("div",{className:"flex flex-row justify-center gap-4",children:[h&&e.jsx(f,{asChild:!0,children:e.jsx(x,{onClick:()=>v(!1),variant:"default",className:"gap-2",children:e.jsx("span",{children:u?"Roll-Back":r?c?"Update":"Re-Install":"Install"})})}),e.jsx(f,{asChild:!0,children:e.jsx(x,{onClick:()=>v(!0),variant:"default",className:"gap-2",children:e.jsx("span",{children:wp.i18n.__("Download")})})}),e.jsx(f,{asChild:!0,children:e.jsx(x,{variant:"outline",children:wp.i18n.__("Cancel")})})]})})]})})]})}export{J as I,q as u};
