import{c as v,f as _,N as m,u as C,j as s,B as r,J as g}from"./DsYCzp-3.d9c493.js";import{h as N,u as R,D as I,a as M,L as b,b as B,c as L,d as E,e as U,f as A,g as h}from"./Ck9Ap-c2.d9c493.js";import{a as P,u as H}from"./DVD3EYek.d9c493.js";/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=v("CloudDownload",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m8 17 4 4 4-4",key:"1ul180"}]]);/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=v("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.396.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=v("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function z(l,n){const o=React.useMemo(()=>["wordpress-themes","wordpress-plugins"].includes(l.type),[l]),{list:a}=_(),i=React.useMemo(()=>a==null?void 0:a.find(x=>x.id===l.id),[a]),e=React.useMemo(()=>i?m(i.version,i.installed_version,"gt")===!0:!1,[i,a]),d=React.useMemo(()=>i&&n?m(i.installed_version,n.version,"gt")===!0:!1,[i,n]);return{isInstalled:i,isNewerVersion:e,isInstallable:o,isRollBack:d}}function Q({item:l,media:n,size:o,variant:a}){const i=P(),{data:e}=N();C();const{isPending:d,mutateAsync:x}=R("item/install"),{isInstalled:t,isNewerVersion:c,isInstallable:w,isRollBack:p}=z(l,n),{clearCache:k}=_(),{tab:D}=H("/item/:type/detail/:id/:tab?");function j(f){if(typeof(e==null?void 0:e.plan_type)>"u"){g.error(wp.i18n.__("License not activated")),i("/activation");return}g.promise(x({item_id:l.id,method:f===!0?"download":"install",media_id:n==null?void 0:n.id}),{description:wp.htmlEntities.decodeEntities(l.title),loading:f===!0?"Downloading":p?wp.i18n.sprintf("Roll-Back to version %s",n.version):t?c?"Updating":"Re-Installing":"Installing",success(u){return u.link&&f===!0&&window.open(u.link,"_blank"),k(),wp.i18n.__("Successful")},error(u){return u.message}})}return s.jsxs(I,{children:[s.jsx(M,{asChild:!0,children:s.jsxs(r,{variant:a,size:o,className:"flex items-center gap-2",disabled:d,children:[d?s.jsx(b,{className:"h-4 w-4 animate-spin"}):s.jsx(y,{width:16}),o!="icon"&&s.jsx("span",{children:w?p?"Roll-Back":t?c?"Update":"Re-Install":"Install":"Download"})]})}),s.jsx(B,{children:s.jsxs("div",{className:"mx-auto w-full max-w-sm",children:[s.jsxs(L,{className:"text-center",children:[s.jsx(E,{className:"text-center leading-normal",children:wp.htmlEntities.decodeEntities(l.title)}),s.jsx(U,{className:"flex flex-col gap-2 text-center",asChild:!0,children:s.jsxs("div",{children:[s.jsx("div",{children:w?p?wp.i18n.sprintf("Roll-back to version from %s to %s",t.installed_version,n.version):t?c?wp.i18n.sprintf("Update version from %s to %s",t.installed_version,t.version):wp.i18n.sprintf(wp.i18n.__("Re-install version %s"),n?n.version:t.version):wp.i18n.sprintf("Install version %s",n?n.version:l.version):wp.i18n.sprintf("Download version %s",n?n.version:l.version)}),s.jsx("div",{children:wp.i18n.sprintf(wp.i18n.__("%d download credit would be consumed from your account."),1)}),s.jsxs("div",{className:"flex flex-row justify-center divide-x",children:[s.jsxs("div",{className:"px-4",children:["Daily Limit: ",e==null?void 0:e.today_limit]}),s.jsxs("div",{className:"px-4",children:["Used Limit: ",e==null?void 0:e.today_limit_used]}),(e==null?void 0:e.plan_title)==="recurring"&&s.jsxs("div",{className:"p-4",children:["Total Limit: ",e==null?void 0:e.total_limit]})]})]})})]}),s.jsx(A,{children:s.jsxs("div",{className:"flex flex-row justify-center gap-4",children:[w&&s.jsx(h,{asChild:!0,children:s.jsxs(r,{onClick:()=>j(!1),variant:"default",className:"gap-2",children:[s.jsx(y,{size:16}),s.jsx("span",{children:p?"Roll-Back":t?c?"Update":"Re-Install":"Install"})]})}),s.jsx(h,{asChild:!0,children:s.jsxs(r,{onClick:()=>j(!0),variant:"outline",className:"gap-2",children:[s.jsx(T,{size:16}),s.jsx("span",{children:wp.i18n.__("Download")})]})}),D!=="changelog"&&s.jsx(h,{asChild:!0,children:s.jsxs(r,{onClick:()=>i("/item/:type/detail/:id/:tab?",{params:{type:l.type,id:l.id,tab:"changelog"}}),variant:"outline",className:"gap-2",children:[s.jsx(q,{size:16}),s.jsx("span",{children:wp.i18n.__("Roll-Back")})]})}),s.jsx(h,{asChild:!0,children:s.jsx(r,{variant:"outline",children:wp.i18n.__("Cancel")})})]})})]})})]})}export{y as C,T as D,Q as I,z as u};
